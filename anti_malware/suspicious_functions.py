import pefile

def extract_imported_functions(file_path):
    """
    Extracts imported functions from the Import Address Table (IAT) of a PE file.

    Args:
        file_path (str): Path to the .exe file.

    Returns:
        list: A list of imported functions.
    """
    try:
        pe = pefile.PE(file_path)
        imported_functions = []
        if hasattr(pe, "DIRECTORY_ENTRY_IMPORT"):
            for entry in pe.DIRECTORY_ENTRY_IMPORT:
                for imp in entry.imports:
                    if imp.name:
                        imported_functions.append(imp.name.decode())
        return imported_functions
    except Exception as e:
        print(f"Error reading imports from {file_path}: {e}")
        return []

def check_suspicious_functions(imported_functions):
    """
    Checks for suspicious functions in the list of imported functions.

    Args:
        imported_functions (list): A list of imported functions.

    Returns:
        list: A list of suspicious functions detected.
    """
    suspicious_functions = [
        # File system manipulation
        "CreateFileA", "WriteFile", "DeleteFileA", "MoveFileA", "CopyFileA",
        # Cryptographic operations
        "CryptEncrypt", "CryptDecrypt", "BCryptEncrypt", "BCryptDecrypt",
        # Process and memory manipulation
        "VirtualAlloc", "VirtualProtect", "CreateProcessA", "OpenProcess",
        # Network communication
        "send", "recv", "InternetOpenA", "InternetConnectA"
    ]

    detected = [func for func in imported_functions if func in suspicious_functions]
    return detected

def main():
    file_path = "example.exe"  # Replace with the path to your .exe file
    imported_functions = extract_imported_functions(file_path)
    if imported_functions:
        print(f"Imported functions in {file_path}:")
        for func in imported_functions:
            print(f" - {func}")

        suspicious = check_suspicious_functions(imported_functions)
        if suspicious:
            print("\nSuspicious functions detected:")
            for func in suspicious:
                print(f" - {func}")
        else:
            print("\nNo suspicious functions detected.")
    else:
        print(f"No imported functions found in {file_path}.")

if __name__ == "__main__":
    main()